<!doctype html><html class=html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>My URL Shortener (thr.fi) Project Writeup | Thirafi Dev Logs</title>
<link rel=icon href=/favicon.ico><meta name=description content="A writeup of my URL Shortener project"><meta property="og:url" content="https://blog.naj.one/posts/url-shortener-writeup/"><meta property="og:site_name" content="Thirafi Dev Logs"><meta property="og:title" content="My URL Shortener (thr.fi) Project Writeup"><meta property="og:description" content="A writeup of my URL Shortener project"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-16T18:21:43+07:00"><meta property="article:modified_time" content="2023-08-16T18:21:43+07:00"><meta property="article:tag" content="Serverless"><meta property="article:tag" content="Cloudflare"><meta itemprop=name content="My URL Shortener (thr.fi) Project Writeup"><meta itemprop=description content="A writeup of my URL Shortener project"><meta itemprop=datePublished content="2023-08-16T18:21:43+07:00"><meta itemprop=dateModified content="2023-08-16T18:21:43+07:00"><meta itemprop=wordCount content="725"><meta itemprop=keywords content="Serverless,Cloudflare"><link rel=stylesheet href=/css/style.min.b7bdb5b68f9542b0a57f52f983d331457d8ec810d72fb016ad8a088f4dd4e11b.css integrity="sha256-t721to+VQrClf1L5g9MxRX2OyBDXL7AWrYoIj03U4Rs=" crossorigin=anonymous></head><body class=body><header class=header><h1>Thirafi Dev Logs</h1><nav class="menu language"><ul class="menu__list language__list"><li class=menu__item><a class=menu__link href=/>Home</a></li><li class=menu__item><a class=menu__link href=/about/>About</a></li><li class=menu__item><a class=menu__link href=/posts/>Posts</a></li><li class=menu__item><a class=menu__link href=/categories/>Categories</a></li><li class=menu__item><a class=menu__link href=/tags/>Tags</a></li></ul></nav></header><main class=main><h1>My URL Shortener (thr.fi) Project Writeup</h1><span class=author>Thirafi Najwan</span><br><time class=published-date datetime=2023-08-16T18:21:43+07:00>2023-08-16</time><details class=details-table-of-contents open><summary>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#tech-stack>Tech Stack</a><ul><li><a href=#frontend>Frontend</a></li><li><a href=#backend>Backend</a></li></ul></li><li><a href=#flowchart>Flowchart</a></li><li><a href=#encryption>Encryption</a></li><li><a href=#qr-code>QR Code</a></li></ul><ul><li><a href=#cloudflare-workers>Cloudflare Workers</a></li></ul></nav></details><p><img src=/images/thrfi-landing.png alt=Landing></p><p>This project idea came up when I needed something cool to display on my Discord profile that was simple enough to make. I think an URL shortener would look cool to display on my profile. Then, as I work on it, I read one of Cloudflare&rsquo;s official <a href=https://developers.cloudflare.com/workers/tutorials/build-a-qr-code-generator/>tutorial projects</a> using Cloudflare Workers and decides to then a QR Code generator feature in the process.</p><h1 class=heading id=overview>Overview<span class=heading__anchor> <a href=#overview>#</a></span></h1><p>This project is a URL shortener with a QR Code generator feature. It is hosted on Cloudflare Workers and uses Cloudflare KV to store the data. The project is written in TypeScript and uses Webpack to bundle the code. With a privacy-first mindset, all data from the user is encrypted using AES-256-GCM or hashed using SHA256 before being stored in the KV. The project is also open-source and can be found on GitHub (<a href=https://github.com/reverseon/thrfi-fe>Frontend</a> and <a href=https://github.com/reverseon/thrfi-be>Backend</a>).</p><h1 class=heading id=process>Process<span class=heading__anchor> <a href=#process>#</a></span></h1><h2 class=heading id=tech-stack>Tech Stack<span class=heading__anchor> <a href=#tech-stack>#</a></span></h2><h3 class=heading id=frontend>Frontend<span class=heading__anchor> <a href=#frontend>#</a></span></h3><p>The frontend is a simple React app that uses vanilla CSS for the UI. It is bundled using Webpack and deployed to Cloudflare Workers using <a href=https://developers.cloudflare.com/workers/wrangler/>Wrangler</a>. I challenge myself to implement the frontend design I found on <a href=https://dribbble.com/shots/21462071-FlexFit-Web-Site-Design-Landing-Page-Home-Page-UI>Dribbble</a>.</p><h3 class=heading id=backend>Backend<span class=heading__anchor> <a href=#backend>#</a></span></h3><p>The backend is a Cloudflare Worker that uses Cloudflare KV to store the data. Why? because I want to challenge myself to build a completely serverless project and Cloudflare Workers is a familiar choice for me since I already use Cloudflare for my DNS.</p><h2 class=heading id=flowchart>Flowchart<span class=heading__anchor> <a href=#flowchart>#</a></span></h2><p>In a bird&rsquo;s view, this is the simplified process of the project, represented using boxes and arrows.</p><p><img src=/images/thrfi_flowchart.jpg alt=Flowchart></p><p>There are four endpoints available in the backend:</p><ul><li><code>/shorten</code> to shorten a URL</li><li><code>/qr</code> to generate a QR Code</li><li><code>/fetch</code> to get the original URL from the shortened URL</li><li><code>/unlock</code> to unlock a shortened URL (if it is password-protected)</li></ul><p>I use <code>itty-router</code> to handle the routing in the backend. The backend also uses <code>Web Crypto API</code> to encrypt the data before storing it in the KV.</p><p>The general flow of the project is:</p><ol><li>User enters a URL to be shortened</li><li>The frontend sends a request to the backend to shorten the URL</li><li>The backend generates a random string as the shortened URL and stores it in the KV (or if back-half is used, it will be stored in the KV instead)</li><li>The backend returns the shortened URL to the frontend</li><li>The frontend displays the shortened URL to the user</li><li>If the URL is password-protected, the user can enter the password to unlock the URL.</li></ol><h2 class=heading id=encryption>Encryption<span class=heading__anchor> <a href=#encryption>#</a></span></h2><p>There are three user inputs that need to be stored:</p><ul><li>The original URL</li><li>The back-half</li><li>The password (if the URL is password-protected)</li></ul><p>User back-half and password is hashed using SHA256 before being stored in the KV. The original URL on the other hand, can&rsquo;t be hashed because it needs to be decrypted later. So, I use AES-256-GCM to encrypt the original URL before storing it in the KV. I did this because, while technically I can decrypt the URL, in an event where the KV is compromised, the attacker will need to brute-force the encryption key to decrypt the URL.</p><h2 class=heading id=qr-code>QR Code<span class=heading__anchor> <a href=#qr-code>#</a></span></h2><p>The QR Code generator is a simple feature that uses <a href=https://www.npmjs.com/package/qr-image>qr-image</a> to generate the QR Code. The QR Code is generated in the backend and then sent to the frontend as a base64 string. The frontend then displays the QR Code to the user.</p><h1 class=heading id=challenges>Challenges<span class=heading__anchor> <a href=#challenges>#</a></span></h1><h2 class=heading id=cloudflare-workers>Cloudflare Workers<span class=heading__anchor> <a href=#cloudflare-workers>#</a></span></h2><p>This is my first time using Cloudflare Workers and I have to say, it is a bit confusing at first. I have to learn how to use <code>wrangler</code> and how to deploy the project to Cloudflare Workers. I also have to learn how to use <code>Web Crypto API</code> to encrypt the data before storing it in the KV. I also have to learn how to use <code>itty-router</code> to handle the routing in the backend.</p><h1 class=heading id=conclusion>Conclusion<span class=heading__anchor> <a href=#conclusion>#</a></span></h1><p>This project is a fun project to work on. I learned a lot of new things and I also get to challenge myself to build a completely serverless project. I also get to learn how to use <code>Web Crypto API</code> and <code>itty-router</code>. I also get to learn how to use <code>wrangler</code> and how to deploy the project to Cloudflare Workers. I also get to learn how to use <code>qr-image</code> to generate a QR Code. Overall, this is a fun project to work on and I&rsquo;m happy with the result.</p><div><div>Tags:</div><ul><li><a href=/tags/serverless/>Serverless</a></li><li><a href=/tags/cloudflare/>Cloudflare</a></li></ul></div><div><div>Categories:</div><ul><li><a href=/categories/project/>Project</a></li></ul></div><nav class=page-nav><a href=/posts/image-hosting-service-writeup/>Prev: Image Hosting Service and How to implement MVC-ish architecture in Cloudflare Workers</a></nav></main><footer class=footer><p class=footer__copyright-notice>&copy; 2024</p><p class=footer__theme-info>Built with <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/CyrusYip/hugo-theme-yue>Yue</a></p></footer></body></html>